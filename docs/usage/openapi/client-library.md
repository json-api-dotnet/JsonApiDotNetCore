# OpenAPI Client Library

You can generate a client library in various programming languages from the OpenAPI specification file that JsonApiDotNetCore APIs provide. For C# .NET clients generated using NSwag, we provide an additional package that introduces better support for PATCH and POST requests. The issue here is that a property on a generated C# class being `null` could mean "set the value to `null` in the request" or "this is `null` because I never touched it".

## Installation

You are required to install the following NuGet packages:

- `JsonApiDotNetCore.OpenApiClient`
- `NSwag.ApiDescription.Client`
- `Microsoft.Extensions.ApiDescription.Cient`
- `NSwag.ApiDescription.Client`

The following examples demonstrate how to install the `JsonApiDotNetCore.OpenApiClient` package.

### CLI

```
dotnet add package JsonApiDotNetCore.OpenApiClient
```

### Visual Studio

```powershell
Install-Package JsonApiDotNetCore.OpenApiClient
```

### *.csproj

```xml
<ItemGroup>
  <!-- Be sure to check NuGet for the latest version # -->
  <PackageReference Include="JsonApiDotNetCore.OpenApiClient" Version="4.0.0" />
</ItemGroup>
```


## Adding an OpenApiReference

Add a reference to your OpenAPI specification in your project file as demonstrated below.

```xml
<ItemGroup>
 <OpenApiReference Include="swagger.json">
   <Namespace>JsonApiDotNetCoreExampleClient.GeneratedCode</Namespace>
   <ClassName>ExampleApiClient</ClassName>
   <CodeGenerator>NSwagCSharp</CodeGenerator>
   <Options>/UseBaseUrl:false /GenerateClientInterfaces:true</Options>
 </OpenApiReference>
</ItemGroup>
```


## Usage

The NSwag tooling generates the OpenAPI client during a prebuild step. Once your application is built,
you can instantiate it using the class name as indicated in the project file.

```c#
namespace JsonApiDotNetCoreExampleClient
{
    class Program
    {
        static void Main(string[] args)
        {
            using (HttpClient httpClient = new HttpClient())
            {
                ExampleApiClient exampleApiClient = new ExampleApiClient(httpClient);

                // IntelliSense is now available on `exampleApiClient`!
            }
        }
    }
}
```

Support for partial write requests can be enabled by leveraging the extensibility points of the generated client.

```c#
namespace JsonApiDotNetCoreExampleClient.GeneratedCode
{
    // Note that this class should be in the same namespace as the ExampleApiClient generated by NSwag. 
    public partial class ExampleApiClient : JsonApiClient
    {
        partial void UpdateJsonSerializerSettings(JsonSerializerSettings settings)
        {
            SetSerializerSettingsForJsonApi(settings);
        }
    }
}
```

You can now perform a write request by calling the `RegisterAttributesForRequest` method. Calling this method treats all attributes that contain their default value (<c>null</c> for reference types, <c>0</c> for integers, <c>false</c> for booleans, etc) as omitted unless explicitly listed to include them using the `alwaysIncludedAttributeSelectors` parameter.

```c#
// Program.cs
static void Main(string[] args)
{
    using (HttpClient httpClient = new HttpClient())
    {
        ExampleApiClient exampleApiClient = new ExampleApiClient(httpClient);

        var requestDocument = new PersonPatchRequestDocument
        {
            Data = new PersonDataInPatchRequest
            {
                Id = "546",
                Type = PersonResourceType.People,
                Attributes = new PersonAttributesInPatchRequest
                {
                    FirstName = "Jack"
                }
            }
        };

        using (apiClient.RegisterAttributesForRequestDocument<PersonPatchRequestDocument, PersonDataInPatchRequest>(requestDocument, person => person.LastName)
        {
            await exampleApiClient.PatchPersonAsync(543, requestDocument));

            // The request will look like this:
            //
            // {
            //   "data": {
            //     "type": "people",
            //     "id": "543",
            //     "attributes": {
            //       "firstName": "Jack",
            //       "lastName": null,
            //     }
            //   }
            // }
        }

    }
}
```

