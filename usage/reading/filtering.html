<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Filtering </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Filtering ">
    <meta name="generator" content="docfx 2.58.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="filtering">Filtering</h1>

<p><em>since v4.0</em></p>
<p>Resources can be filtered by attributes using the <code>filter</code> query string parameter.
By default, all attributes are filterable.
The filtering strategy we have selected, uses the following form.</p>
<pre><code>?filter=expression
</code></pre><p>Expressions are composed using the following functions:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Function</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Equality</td>
<td><code>equals</code></td>
<td><code>?filter=equals(lastName,&#39;Smith&#39;)</code></td>
</tr>
<tr>
<td>Less than</td>
<td><code>lessThan</code></td>
<td><code>?filter=lessThan(age,&#39;25&#39;)</code></td>
</tr>
<tr>
<td>Less than or equal to</td>
<td><code>lessOrEqual</code></td>
<td><code>?filter=lessOrEqual(lastModified,&#39;2001-01-01&#39;)</code></td>
</tr>
<tr>
<td>Greater than</td>
<td><code>greaterThan</code></td>
<td><code>?filter=greaterThan(duration,&#39;6:12:14&#39;)</code></td>
</tr>
<tr>
<td>Greater than or equal to</td>
<td><code>greaterOrEqual</code></td>
<td><code>?filter=greaterOrEqual(percentage,&#39;33.33&#39;)</code></td>
</tr>
<tr>
<td>Contains text</td>
<td><code>contains</code></td>
<td><code>?filter=contains(description,&#39;cooking&#39;)</code></td>
</tr>
<tr>
<td>Starts with text</td>
<td><code>startsWith</code></td>
<td><code>?filter=startsWith(description,&#39;The&#39;)</code></td>
</tr>
<tr>
<td>Ends with text</td>
<td><code>endsWith</code></td>
<td><code>?filter=endsWith(description,&#39;End&#39;)</code></td>
</tr>
<tr>
<td>Equals one value from set</td>
<td><code>any</code></td>
<td><code>?filter=any(chapter,&#39;Intro&#39;,&#39;Summary&#39;,&#39;Conclusion&#39;)</code></td>
</tr>
<tr>
<td>Collection contains items</td>
<td><code>has</code></td>
<td><code>?filter=has(articles)</code></td>
</tr>
<tr>
<td>Negation</td>
<td><code>not</code></td>
<td><code>?filter=not(equals(lastName,null))</code></td>
</tr>
<tr>
<td>Conditional logical OR</td>
<td><code>or</code></td>
<td><code>?filter=or(has(orders),has(invoices))</code></td>
</tr>
<tr>
<td>Conditional logical AND</td>
<td><code>and</code></td>
<td><code>?filter=and(has(orders),has(invoices))</code></td>
</tr>
</tbody>
</table>
<p>Comparison operators compare an attribute against a constant value (between quotes), null or another attribute:</p>
<pre><code class="lang-http">GET /users?filter=equals(displayName,&#39;Brian O&#39;&#39;Connor&#39;) HTTP/1.1
</code></pre><pre><code class="lang-http">GET /users?filter=equals(displayName,null) HTTP/1.1
</code></pre><pre><code class="lang-http">GET /users?filter=equals(displayName,lastName) HTTP/1.1
</code></pre><p>Comparison operators can be combined with the <code>count</code> function, which acts on HasMany relationships:</p>
<pre><code class="lang-http">GET /blogs?filter=lessThan(count(owner.articles),&#39;10&#39;) HTTP/1.1
</code></pre><pre><code class="lang-http">GET /customers?filter=greaterThan(count(orders),count(invoices)) HTTP/1.1
</code></pre><p>When filters are used multiple times on the same resource, they are combined using an OR operator.
The next request returns all customers that have orders -or- whose last name is Smith.</p>
<pre><code class="lang-http">GET /customers?filter=has(orders)&amp;filter=equals(lastName,&#39;Smith&#39;) HTTP/1.1
</code></pre><p>Aside from filtering on the resource being requested (which would be blogs in /blogs and articles in /blogs/1/articles), 
filtering on included collections can be done using bracket notation:</p>
<pre><code class="lang-http">GET /articles?include=author,tags&amp;filter=equals(author.lastName,&#39;Smith&#39;)&amp;filter[tags]=contains(label,&#39;tech&#39;,&#39;design&#39;) HTTP/1.1
</code></pre><p>In the above request, the first filter is applied on the collection of articles, while the second one is applied on the nested collection of tags.</p>
<p>Putting it all together, you can build quite complex filters, such as:</p>
<pre><code class="lang-http">GET /blogs?include=owner.articles.revisions&amp;filter=and(or(equals(title,&#39;Technology&#39;),has(owner.articles)),not(equals(owner.lastName,null)))&amp;filter[owner.articles]=equals(caption,&#39;Two&#39;)&amp;filter[owner.articles.revisions]=greaterThan(publishTime,&#39;2005-05-05&#39;) HTTP/1.1
</code></pre><p><em>since v4.2</em></p>
<p>The <code>has</code> function takes an optional filter condition as second parameter, for example:</p>
<pre><code class="lang-http">GET /customers?filter=has(orders,not(equals(status,&#39;Paid&#39;))) HTTP/1.1
</code></pre><p>Which returns only customers that have at least one unpaid order.</p>
<h1 id="legacy-filters">Legacy filters</h1>
<p>The next section describes how filtering worked in versions prior to v4.0. They are always applied on the set of resources being requested (no nesting).
Legacy filters use the following form.</p>
<pre><code>?filter[attribute]=value
</code></pre><p>For operations other than equality, the query can be prefixed with an operation identifier.
Examples can be found in the table below.</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Prefix</th>
<th>Example</th>
<th>Equivalent form in v4.0</th>
</tr>
</thead>
<tbody>
<tr>
<td>Equality</td>
<td><code>eq</code></td>
<td><code>?filter[lastName]=eq:Smith</code></td>
<td><code>?filter=equals(lastName,&#39;Smith&#39;)</code></td>
</tr>
<tr>
<td>Non-equality</td>
<td><code>ne</code></td>
<td><code>?filter[lastName]=ne:Smith</code></td>
<td><code>?filter=not(equals(lastName,&#39;Smith&#39;))</code></td>
</tr>
<tr>
<td>Less than</td>
<td><code>lt</code></td>
<td><code>?filter[age]=lt:25</code></td>
<td><code>?filter=lessThan(age,&#39;25&#39;)</code></td>
</tr>
<tr>
<td>Less than or equal to</td>
<td><code>le</code></td>
<td><code>?filter[lastModified]=le:2001-01-01</code></td>
<td><code>?filter=lessOrEqual(lastModified,&#39;2001-01-01&#39;)</code></td>
</tr>
<tr>
<td>Greater than</td>
<td><code>gt</code></td>
<td><code>?filter[duration]=gt:6:12:14</code></td>
<td><code>?filter=greaterThan(duration,&#39;6:12:14&#39;)</code></td>
</tr>
<tr>
<td>Greater than or equal to</td>
<td><code>ge</code></td>
<td><code>?filter[percentage]=ge:33.33</code></td>
<td><code>?filter=greaterOrEqual(percentage,&#39;33.33&#39;)</code></td>
</tr>
<tr>
<td>Contains text</td>
<td><code>like</code></td>
<td><code>?filter[description]=like:cooking</code></td>
<td><code>?filter=contains(description,&#39;cooking&#39;)</code></td>
</tr>
<tr>
<td>Equals one value from set</td>
<td><code>in</code></td>
<td><code>?filter[chapter]=in:Intro,Summary,Conclusion</code></td>
<td><code>?filter=any(chapter,&#39;Intro&#39;,&#39;Summary&#39;,&#39;Conclusion&#39;)</code></td>
</tr>
<tr>
<td>Equals none from set</td>
<td><code>nin</code></td>
<td><code>?filter[chapter]=nin:one,two,three</code></td>
<td><code>?filter=not(any(chapter,&#39;one&#39;,&#39;two&#39;,&#39;three&#39;))</code></td>
</tr>
<tr>
<td>Equal to null</td>
<td><code>isnull</code></td>
<td><code>?filter[lastName]=isnull:</code></td>
<td><code>?filter=equals(lastName,null)</code></td>
</tr>
<tr>
<td>Not equal to null</td>
<td><code>isnotnull</code></td>
<td><code>?filter[lastName]=isnotnull:</code></td>
<td><code>?filter=not(equals(lastName,null))</code></td>
</tr>
</tbody>
</table>
<p>Filters can be combined and will be applied using an OR operator. This used to be AND in versions prior to v4.0.</p>
<p>Attributes to filter on can optionally be prefixed with a HasOne relationship, for example:</p>
<pre><code class="lang-http">GET /api/articles?include=author&amp;filter[caption]=like:marketing&amp;filter[author.lastName]=Smith HTTP/1.1
</code></pre><p>Legacy filter notation can still be used in v4.0 by setting <code>options.EnableLegacyFilterNotation</code> to <code>true</code>.
If you want to use the new filter notation in that case, prefix the parameter value with <code>expr:</code>, for example:</p>
<pre><code class="lang-http">GET /articles?filter[caption]=tech&amp;filter=expr:equals(caption,&#39;cooking&#39;)) HTTP/1.1
</code></pre><h1 id="custom-filters">Custom Filters</h1>
<p>There are multiple ways you can add custom filters:</p>
<ol>
<li>Implementing <code>IResourceDefinition.OnApplyFilter</code> (see <a href="../extensibility/resource-definitions.html#change-filters">here</a>) and inject <code>IRequestQueryStringAccessor</code>, which works at all depths, but filter operations are constrained to what <code>FilterExpression</code> provides</li>
<li>Implementing <code>IResourceDefinition.OnRegisterQueryableHandlersForQueryStringParameters</code> as described <a href="../extensibility/resource-definitions.html#custom-query-string-parameters">here</a>, which enables the full range of <code>IQueryable&lt;T&gt;</code> functionality, but only works on primary endpoints</li>
<li>Add an implementation of <code>IQueryConstraintProvider</code> to supply additional <code>FilterExpression</code>s, which are combined with existing filters using AND operator</li>
<li>Override <code>EntityFrameworkCoreRepository.ApplyQueryLayer</code> to adapt the <code>IQueryable&lt;T&gt;</code> expression just before execution</li>
<li>Take a deep dive and plug into reader/parser/tokenizer/visitor/builder for adding additional general-purpose filter operators</li>
</ol>
<h1 id="filter-syntax">Filter syntax</h1>
<p>For reference, we provide the EBNF grammar for filter expressions below (in <a href="https://github.com/antlr/antlr4">ANTLR4</a> style):</p>
<pre><code class="lang-ebnf">grammar Filter;

filterExpression:
    notExpression
    | logicalExpression
    | comparisonExpression
    | matchTextExpression
    | anyExpression
    | hasExpression;

notExpression:
    &#39;not&#39; LPAREN filterExpression RPAREN;

logicalExpression:
    ( &#39;and&#39; | &#39;or&#39; ) LPAREN filterExpression ( COMMA filterExpression )* RPAREN;

comparisonExpression:
    ( &#39;equals&#39; | &#39;greaterThan&#39; | &#39;greaterOrEqual&#39; | &#39;lessThan&#39; | &#39;lessOrEqual&#39; ) LPAREN (
        countExpression | fieldChain
    ) COMMA (
        countExpression | literalConstant | &#39;null&#39; | fieldChain
    ) RPAREN;

matchTextExpression:
    ( &#39;contains&#39; | &#39;startsWith&#39; | &#39;endsWith&#39; ) LPAREN fieldChain COMMA literalConstant RPAREN;

anyExpression:
    &#39;any&#39; LPAREN fieldChain COMMA literalConstant ( COMMA literalConstant )+ RPAREN;

hasExpression:
    &#39;has&#39; LPAREN fieldChain ( COMMA filterExpression )? RPAREN;

countExpression:
    &#39;count&#39; LPAREN fieldChain RPAREN;

fieldChain:
    FIELD ( &#39;.&#39; FIELD )*;

literalConstant:
    ESCAPED_TEXT;

LPAREN: &#39;(&#39;;
RPAREN: &#39;)&#39;;
COMMA: &#39;,&#39;;

fragment OUTER_FIELD_CHARACTER: [A-Za-z0-9];
fragment INNER_FIELD_CHARACTER: [A-Za-z0-9_-];
FIELD: OUTER_FIELD_CHARACTER ( INNER_FIELD_CHARACTER* OUTER_FIELD_CHARACTER )?;

ESCAPED_TEXT: &#39;\&#39;&#39; ( ~[&#39;] | &#39;\&#39;\&#39;&#39; )* &#39;\&#39;&#39; ;

LINE_BREAKS: [\r\n]+ -&gt; skip;
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/json-api-dotnet/JsonApiDotNetCore/blob/release/4.2.0/docs/usage/reading/filtering.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
